<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>
    function chatPopup(){
        window.open('/chat/room?writer=[[${writer}]]&itemNo=[[${itemForm.item_no}]]',"판매자에게 연락하기",'width=700px,height=800px');
      }
  </script>
  <script th:inline="javascript">
    $(document).ready(function (){
      $('button#btnBidding').on('click', function (){
        var biddingPrice = $('input#biddingPrice').val();
        if(biddingPrice == "")
          alert('제시할 금액을 입력하세요');
          return false;
      });
    });

  </script>
</head>

<body>
<div class="container">
  <table class="table" >
    <tr>
      <td th:text="상세조회"><h2>상세조회</h2></td>
    </tr>
    <tr>
      <td th:text="${itemForm.title}"></td>
    </tr>

    <tr>
      <td>작성일 : <span th:text="${itemForm.reg_date}" /></td>
      <td>작성자 : <span th:text="${writer}"/></td>
    </tr>

    <tr>
      시작가 : <span th:text="${itemForm.starting_bid}"/> <br>
      현재가 : <span th:text="${itemForm.winning_bid}"/>
    <div th:if="${itemForm.soldOut}">
      <button type="button">판매완료</button>
    </div>
    </tr>
    <tr>
      <td th:text="${#dates.format(itemForm.reg_date, 'yyyy-MM-dd')}"></td>
    </tr>
    <tr>
      <td th:text="${itemForm.writer}"></td>
    </tr>
    <tr th:each="file : ${filesList}">
      <td>
        <!--<img th:src="@{'/images/'}+${file.fileName}" style="width: 300px; height:auto;">-->
      </td>
    </tr>
    <tr>
      <td th:text="${itemForm.content}"></td>
    </tr>
    <tr>
      <td id="deadline_data" data-th-align="${itemForm.deadline}" th:type="hidden"></td>

    </tr>
  </table>
  <div th:id="contentArea"></div>
  <!-- 수정/삭제 -->
  <div th:if="${user.getUid() == writer}">
    <a th:href="@{'/items/edit/' + ${itemForm.item_no}}">
      <button class="btn btn-outline-warning">수정</button>
    </a>
    <form id="delete-form" th:action="@{'/items/' + ${itemForm.item_no}}" method="post">
      <input type="hidden" name="_method" value="delete" />
      <button class="btn btn-outline-warning" id="delete-btn">삭제</button>
    </form>
  </div>

  <div th:if="${user.getUid()==writer} and ${itemForm.soldOut==false}" >
    <form action="/sell" method="post">
      <input type="hidden" name="itemNo" th:value="${itemForm.item_no}"/>
      <button type="submit" id="btnSell">낙찰</button>
    </form>

  </div>

  <div th:if="!${user.getUid()==writer} and ${itemForm.soldOut==false}">
    <form action="/bidding" method="post">
      <input type="hidden" name="itemNo" th:value="${itemForm.item_no}"/>
      <input type="hidden" name="uid" th:value="${user.uid}"/>
      <input type="text" name="biddingPrice" id="biddingPrice" placeholder="제안할 가격"/>
      <button type="submit" id="btnBidding">제시</button>
    </form>
    <button class="btn btn-outline-warning" onclick="return chatPopup();">판매자와 대화하기</button>
  </div>


  <div th:if="${user.getUid()!=writer}">

  </div>

  <a th:href="@{'/items/'}">
    <button class="btn btn-outline-warning">취소</button>
  </a>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script>
$(document).ready(function () {
  var deadline1 = document.getElementById("deadline_data");
  var deadline = deadline1.getAttribute("align");

/*
  var dday = new Date(deadline);
  dday.setHours(0);
  dday.getTime();
  var today = new Date().getTime();
  var gap = dday - today;
  setInterval(function () {
    if (gap < 0) {
      clearInterval();
      document.getElementById("contentArea").innerHTML = '마감되었습니다.';
      return;
    }
    var day = Math.ceil(gap / (1000 * 60 * 60 * 24));
    var hour = Math.ceil((gap % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var min = Math.ceil((gap % (1000 * 60 * 60)) / (1000 * 60));
    var sec = Math.ceil((gap % (1000 * 60)) / 1000);
    document.getElementById("contentArea").innerHTML = "마감기한까지 " + day + "일 " + hour + "시간 " + min + "분 " + sec + "초 남았습니다."
  }, 1000);
*/

  setInterval(function (){

     var end = new Date(deadline);
     end.setHours(0);
     var now = new Date();
     var distance = end - now;

     var _second = 1000;
     var _minute = _second * 60;
     var _hour = _minute * 60;
     var _day = _hour * 24;

    if (distance < 0) {
      clearInterval();
      document.getElementById("contentArea").innerHTML = '마감되었습니다.';
      return;
    }

     var days = Math.floor(distance / _day);
     var hours = Math.floor((distance % _day) / _hour);
     var minutes = Math.floor((distance % _hour) / _minute);
     var seconds = Math.floor((distance % _minute) / _second);

     document.getElementById("contentArea").innerHTML = days + '일 ' + hours + '시간 ' + minutes + '분 ' + seconds + '초';

   },1000);
})
  </script>

</body>
</html>




<!--
<body>
<h2 th:text="${itemForm.title}"></h2>
<p>작성일 : <span th:text="${itemForm.reg_date}" /> </p>
<p>작성자 : <span th:text="${writer}"/></p>

<p>
  시작가 : <span th:text="${itemForm.starting_bid}"/> <br>
  현재가 : <span th:text="${itemForm.winning_bid}"/>
<div th:if="${itemForm.soldOut}">
  <button type="button">판매완료</button>
</div>
</p>

<div th:if="${user.getUid()==writer} and ${itemForm.soldOut==false}" >
  <form action="/sell" method="post">
    <input type="hidden" name="itemNo" th:value="${itemForm.item_no}"/>
    <button type="submit" id="btnSell">낙찰</button>
  </form>
</div>

<div th:if="!${user.getUid()==writer} and ${itemForm.soldOut==false}">
  <form action="/bidding" method="post">
    <input type="hidden" name="itemNo" th:value="${itemForm.item_no}"/>
    <input type="hidden" name="uid" th:value="${user.uid}"/>
    <input type="text" name="biddingPrice" id="biddingPrice" placeholder="제안할 가격"/>
    <button type="submit" id="btnBidding">제시</button>
  </form>
</div>


<div th:if="${user.getUid()!=writer}">
  <button onclick="return chatPopup();">판매자와 대화하기</button>
</div>
&lt;!&ndash;<img th:src="@{'/images/'}+${file.fileName}" style="width: 300px; height:auto;">&ndash;&gt;
<table>
  <tr th:each="file : ${filesList}">
    <td>
      <img th:src="@{'/images/'}+${file.fileName}" style="width: 300px; height:auto;">
    </td>
  </tr>
</table>
<p th:text="${itemForm.content}"></p>

&lt;!&ndash; 수정/삭제 &ndash;&gt;

<div th:if="${user.getUid()==writer}">
  <a th:href="@{'/items/edit/' + ${itemForm.item_no}}">
    <button class="btn btn-outline-warning">수정</button>
  </a>
  <form id="delete-form" th:action="@{'/items/' + ${itemForm.item_no}}" method="post">
    <input type="hidden" name="_method" value="delete"/>
    <button class="btn btn-outline-warning" id="delete-btn">삭제</button>
  </form>
</div>

-->



</body>
</html>